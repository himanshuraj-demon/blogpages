<!DOCTYPE html>
<html lang="en">

<head>
    <%- include("./partials/head") %>
    <title><%= blog.title %></title>

<style>

/* PREMIUM BLOG CONTENT */

.blog-wrapper{
    max-width: 750px;
    margin:auto;
}

.blog-content{
    font-size:1.1rem;
    line-height:1.8;
}

/* COMMENT CARD */

.comment-card{
    border-radius:12px;
    transition:all .3s ease;
}

.comment-card:hover{
    transform:translateY(-3px);
    box-shadow:0 10px 25px rgba(0,0,0,0.08);
}

/* RELATED BLOG CARDS */

.related-card{
    border-radius:14px;
    overflow:hidden;
    transition:all .35s ease;
}

.related-card:hover{
    transform:translateY(-6px);
    box-shadow:0 20px 35px rgba(0,0,0,0.1);
}

.related-img{
    height:220px;
    object-fit:cover;
    transition:transform .5s ease;
}

.related-card:hover .related-img{
    transform:scale(1.05);
}

/* DARK MODE SUPPORT */

body.dark-mode .comment-card,
body.dark-mode .related-card{
    background:rgba(30,30,30,0.7);
    backdrop-filter:blur(10px);
}

</style>

</head>

<body>

<%- include("./partials/nav") %>

<div class="container-xl py-5">

<div class="blog-wrapper">

    <!-- BLOG TITLE -->
    <div class="text-center mb-4">
        <h1 class="fw-bold display-6"><%= blog.title %></h1>
        <p class="text-muted">By <%= blog.createdBy.name %></p>
    </div>

    <!-- COVER IMAGE -->
    <% if(blog.coverImg){ %>
    <img src="<%= blog.coverImg %>" class="img-fluid rounded shadow-sm mb-4">
    <% } %>

    <!-- BLOG CONTENT -->
    <div class="blog-content mb-5">
        <div id="blogContent"></div>
    </div>

    <!-- COMMENT INPUT -->
    <% if (locals.user) { %>
    <form action='/blog/comment/<%= blog._id %>' method="POST" class="mb-4">
        <div class="input-group">
            <input type="text" class="form-control" placeholder="Write a comment..." name="content">
            <button class="btn btn-dark">Comment</button>
        </div>
    </form>
    <% } %>

    <!-- COMMENTS -->
    <h4 class="mb-3">Comments(<%= comments.length %>) ðŸ’¬</h4>

    <% comments.forEach(element=> { %>

    <div class="card comment-card mb-3 border-0 shadow-sm">

        <div class="card-header d-flex justify-content-between">

            <div>
                <img src="/images/defualt.jpg" width="28" class="rounded-circle me-2">
                <%= element.createdBy.name %>
            </div>

            <% if(locals.user &&
                (locals.user._id.toString()===element.createdBy._id.toString()
                || locals.user._id.toString()===blog.createdBy._id.toString())) { %>

                <form action="/blog/comment/delete/<%= element._id %>" method="POST">
                    <button class="btn btn-sm btn-danger">Delete</button>
                </form>

            <% } %>

        </div>

        <div class="card-body">
            <p class="mb-0"><%= element.content %></p>
        </div>

    </div>

    <% }) %>

</div>
</div>

<!-- RELATED BLOGS -->

<div class="container-xl pb-5">

<h3 class="mb-4">More Blogs</h3>

<div class="row g-4">

<% blogs.forEach(element=> { %>

<div class="col-12 col-md-6 col-lg-4">

<div class="card related-card h-100 border-0 shadow-sm">

<div class="overflow-hidden">
<img src="<%= element.coverImg %>" class="card-img-top related-img">
</div>

<div class="card-body d-flex flex-column">

<h5 class="text-center fw-semibold">
<%= element.title.split('"')[0] %>
</h5>

<p class="text-muted flex-grow-1">
<%= element.body.substring(0,120) %>...
</p>

<a href="/blog/<%= element._id %>" class="btn btn-dark mt-auto">
Read â†’
</a>

</div>
</div>

</div>

<% }) %>

</div>

</div>

<%- include("./partials/footer") %>
<%- include("./partials/script") %>

<!-- MARKDOWN RENDER -->

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
document.getElementById("blogContent").innerHTML =
marked.parse(`<%- blog.body %>`);
</script>

</body>
</html>
